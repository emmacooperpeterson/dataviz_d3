<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript" src="./d3/d3.min.js"></script>
  <title>First d3 Graph</title>

  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

  <style>
    svg {background-color: #f4f4f4;}

    /* bars */
    .labor_bar {fill: #9a9b94;}
    .adult_bar {fill: #f6c90e;}
    .minor_bar {fill: #303841;}

    #title {
      font-size: 20px;
      font-family: 'Montserrat', sans-serif;}

    #subtitle {
      font-size: 15px;
      font-family: 'Courier New'}

    #label {
      font-size: 10px;
      font-family: 'Montserrat', sans-serif;}


  </style>
</head>

<body>

  <div class="container">
    <div id="chart"></div>
  </div>


  <script>

  //set margins
    var margin = {top: 175, right: 75, bottom: 100, left: 50};
    var width = 800 - margin.left - margin.right;
    var height = 600 - margin.top - margin.bottom;



    d3.json("count_by_type.json", function(error, data) {
      if (error) throw error;

      //sort big to small
      dataset = data.sort(function(a,b) {return b.count - a.count;});

      dataset.forEach(function (d) {
        d.type = d.type
        d.count = +d.count;
      });

      makeBarchart();

    });



    function makeBarchart() {
      console.log(dataset);

      var xScale = d3.scaleBand()
        .domain(dataset.map(function(d) {return d.type;}))
        .range([0,width]);

      var yScale = d3.scaleLinear()
        .domain([d3.max(dataset, function(d) {return d.count;}), 0])
        .range([height, 0]);

      svg = d3.select("#chart")
        .append('svg')
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom);

      svg.append('g')
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .call(d3.axisTop(xScale));

      svg.append('g')
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
        .call(d3.axisLeft(yScale));

      var g = svg.append('g')
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      //bars
      g.selectAll(".bar")
        .data(dataset)
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("x", function(d) {return xScale(d.type);})
        .attr("y", 0)
        .attr("width", function(d) {return xScale.bandwidth();})
        .attr("height", function(d) {return yScale(d.count);})
        .attr("class", function(d) {
          var c
          if (d.type == 'labor') {c = 'labor_bar'}
          else if (d.type == 'adult_sex') {c = 'adult_bar'}
          else {c = 'minor_bar'}
          return c
        });

      //title
      svg.append("text")
        .attr("id", "title")
        .attr("y", margin.left)
        .attr("x", margin.left)
        .style("text-anchor", "left")
        .text("Minor sex trafficking comprises majority of U.S. human trafficking prosecutions");

      //subtitle
      svg.append("text")
        .attr("id", "subtitle")
        .attr("y", margin.left * 1.5)
        .attr("x", margin.left)
        .style("text-anchor", "left")
        .text("U.S. human trafficking cases by type");

      //axis labels
      svg.append("text")
        .attr("id", "label")
        .attr("y", margin.top - 30)
        .attr("x", (width + margin.left + margin.right) / 2)
        .style("text-anchor", "middle")
        .text("Type of trafficking");


      };





  </script>


</body>
</html>
